hooks:
  post-start:
    # Private files directory.
    - exec: mkdir /var/www/private

    # Install profile
    - exec: drush site-install server -y --existing-config

    # Make sure Elasticsearch is accessible, wait until if not up to 10 seconds.
    - exec: timeout 10 bash -c 'until printf "" 2>>/dev/null >>/dev/tcp/$0/$1; do sleep 1; done' elasticsearch 9200

    # Setup Elasticsearch
    - exec: "./vendor/bin/robo elasticsearch:provision http://elasticsearch:9200 '' ''"

    # Compile theme in debug, so we can develop with all Tailwinds' classes.
    # On deploy, we purge un-needed CSS.
    - exec-host: ddev robo theme:compile-debug

    # Execute the migrations
    - exec: drush pm-enable server_migrate -y
    - exec: drush migrate:import --group server
    - exec: drush pm-uninstall migrate -y

    # Clear cache, for example for entity view builder plugins to take effect.
    - exec: drush cr

    # Index content.
    - exec: drush sapi-c
    - exec: drush sapi-i

    # Generate one-time login link
    - exec: drush uli
